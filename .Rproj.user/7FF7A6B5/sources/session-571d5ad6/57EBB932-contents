---
title: "Simulation"
subtitle: "Viá»‡t Nam, 2024"
categories: ["SupplyChainManagement", "Simulation","Agent Based Modeling"]
description: "ÄÃ¢y lÃ  bÃ i viáº¿t cá»§a tÃ´i vá» cÃ¡ch sá»­ dá»¥ng R trong viá»‡c giáº£ láº­p"
author: "Cao XuÃ¢n Lá»™c"
date: "2024-11-13"
title-block-banner: img/autumn.jpg
title-block-banner-color: "white"
format: 
  html:
    code-fold: true
    code-tools: true
bibliography: references.bib
---

HÃ´m nay chÃºng ta sáº½ qua 1 pháº§n khÃ¡c trong **Supply chain management** Ä‘Ã³ lÃ : giáº£ láº­p (*simulation*).

## Tá»•ng quÃ¡t:

```{r}
#| include: false
#| message: false
#| warning: false
pacman::p_load(
janitor,
tidyverse,
dplyr,
tidyr,
magrittr,
shiny,
leaflet,
reactable,
leaflet.extras,
ggplot2,
quarto,
reactablefmtr
)
```

### Äá»‹nh nghÄ©a:

**Simulation - giáº£ láº­p** lÃ  má»™t kÄ© thuáº­t mÃ¡y tÃ­nh nháº±m táº¡o ra dá»¯ liá»‡u má»™t cÃ¡ch ngáº«u nhiÃªn vÃ  dá»±a vÃ o Ä‘Ã³ dá»± Ä‘oÃ¡n quÃ¡ trÃ¬nh phÃ¡t triá»ƒn, hoáº¡t Ä‘á»™ng cá»§a má»™t sá»± váº­t, hiá»‡n tÆ°á»£ng trong má»™t Ä‘Æ¡n vá»‹ thá»i gian. Má»¥c Ä‘Ã­ch nháº±m Ä‘Ã¡nh giÃ¡ má»©c Ä‘á»™ hiá»‡u quáº£ cá»§a cÃ¡c giáº£i phÃ¡p cho váº¥n Ä‘á», rá»§i ro trong tÆ°Æ¡ng lai.

VÃ­ dá»¥ giáº£ láº­p mÃ  báº¡n gáº·p thÆ°á»ng ngÃ y nhÆ° dá»± bÃ¡o thá»i tiáº¿t hay dá»± bÃ¡o tÃ¬nh tráº¡ng lÅ© lá»¥t, sáº¡t lá»Ÿ trong thá»i gian mÆ°a bÃ£o. Gáº§n Ä‘Ã¢y nháº¥t lÃ  mÃ´ hÃ¬nh dá»± Ä‘oÃ¡n sá»‘ ca máº¯c Covid-19 nháº±m Ä‘Ã¡nh giÃ¡ má»©c Ä‘á»™ lÃ¢y nhiá»…m á»Ÿ cÃ¡c khu vá»±c nhÆ° áº£nh dÆ°á»›i Ä‘Ã¢y lÃ  káº¿t quáº£ dá»± bÃ¡o á»Ÿ Má»¹.

```{=html}
<div style="text-align: center; margin-bottom: 20px;">
  <img src="img/covid19.jpg" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
  
  <!-- Picture Name -->
  <div style="text-align: left; margin-top: 10px;">
    HÃ¬nh 1: MÃ´ hÃ¬nh giáº£ láº­p sá»‘ lÆ°á»£ng ngÆ°á»i bá»‹ nhiá»…m Covid-19
  </div>
  
  <!-- Source Link -->
  <div style="text-align: right; font-style: italic; margin-top: 5px;">
    Source: <a href="https://pubmed.ncbi.nlm.nih.gov/33097835/" target="_blank">Link to Image</a>
  </div>
</div>
```
Thá»±c cháº¥t nhiá»u Ä‘Ã¡nh giÃ¡ cho ráº±ng cÃ¡c mÃ´ hÃ¬nh dá»± bÃ¡o Covid-19 Ä‘á»u tháº¥t báº¡i, tá»‘n thá»i gian mÃ  cháº³ng Ä‘Æ°a ra *insight* gÃ¬ Ä‘Ã¡ng giÃ¡. NhÆ°ng luÃ´n nhá»› ráº±ng *"All models are wrong but some are useful" - George Box* nghÄ©a lÃ  má»i mÃ´ hÃ¬nh Ä‘á»u cÃ³ sá»± sai lá»‡ch vÃ  nhiá»‡m vá»¥ cá»§a báº¡n lÃ  tÃ¬m ra mÃ´ hÃ¬nh phÃ¹ há»£p nháº¥t vÃ  táº¡o ra giÃ¡ trá»‹ trong Ä‘á»i thá»±c.

CÃ¡c lá»£i Ã­ch cá»§a viá»‡c *simulation* lÃ :

-   **Kiá»ƒm tra trá»±c giÃ¡c thá»‘ng kÃª** hoáº·c minh há»a cÃ¡c Ä‘áº·c tÃ­nh toÃ¡n há»c mÃ  báº¡n khÃ´ng thá»ƒ dá»… dÃ ng dá»± Ä‘oÃ¡n. VÃ­ dá»¥: Kiá»ƒm tra xem liá»‡u cÃ³ hÆ¡n 5% tÃ¡c Ä‘á»™ng cÃ³ Ã½ nghÄ©a Ä‘á»‘i vá»›i má»™t biáº¿n trong mÃ´ hÃ¬nh khi dá»¯ liá»‡u giáº£ ngáº«u nhiÃªn Ä‘Æ°á»£c táº¡o ra.

-   **Hiá»ƒu lÃ½ thuyáº¿t máº«u vÃ  phÃ¢n phá»‘i xÃ¡c suáº¥t** hoáº·c kiá»ƒm tra xem báº¡n cÃ³ hiá»ƒu cÃ¡c quÃ¡ trÃ¬nh cÆ¡ báº£n cá»§a há»‡ thá»‘ng cá»§a mÃ¬nh hay khÃ´ng. VÃ­ dá»¥: Xem liá»‡u dá»¯ liá»‡u mÃ´ phá»ng láº¥y tá»« cÃ¡c phÃ¢n phá»‘i cá»¥ thá»ƒ cÃ³ thá»ƒ so sÃ¡nh vá»›i dá»¯ liá»‡u thá»±c táº¿ hay khÃ´ng.

-   **Thá»±c hiá»‡n phÃ¢n tÃ­ch Ä‘á»™ máº¡nh cá»§a máº«u**. VÃ­ dá»¥: ÄÃ¡nh giÃ¡ xem kÃ­ch thÆ°á»›c máº«u (trong má»—i láº§n láº·p cá»§a mÃ´ phá»ng) cÃ³ Ä‘á»§ lá»›n Ä‘á»ƒ phÃ¡t hiá»‡n tÃ¡c Ä‘á»™ng mÃ´ phá»ng trong hÆ¡n 80% cÃ¡c trÆ°á»ng há»£p hay khÃ´ng.

-   **Chuáº©n bá»‹ káº¿ hoáº¡ch phÃ¢n tÃ­ch trÆ°á»›c**. Äá»ƒ tá»± tin vá» cÃ¡c phÃ¢n tÃ­ch thá»‘ng kÃª (xÃ¡c nháº­n) mÃ  báº¡n muá»‘n thá»±c hiá»‡n trÆ°á»›c khi thu tháº­p dá»¯ liá»‡u (vÃ­ dá»¥: thÃ´ng qua viá»‡c Ä‘Äƒng kÃ½ trÆ°á»›c hoáº·c bÃ¡o cÃ¡o Ä‘Ã£ Ä‘Äƒng kÃ½), viá»‡c thá»±c hÃ nh cÃ¡c phÃ¢n tÃ­ch trÃªn má»™t bá»™ dá»¯ liá»‡u mÃ´ phá»ng lÃ  ráº¥t há»¯u Ã­ch! Náº¿u báº¡n váº«n chÆ°a cháº¯c cháº¯n vá» bÃ i kiá»ƒm tra thá»‘ng kÃª phÃ¹ há»£p nháº¥t Ä‘á»ƒ Ã¡p dá»¥ng cho dá»¯ liá»‡u cá»§a mÃ¬nh, viá»‡c cung cáº¥p bá»™ dá»¯ liá»‡u mÃ´ phá»ng cho má»™t nhÃ  thá»‘ng kÃª hoáº·c ngÆ°á»i hÆ°á»›ng dáº«n sáº½ giÃºp há» Ä‘Æ°a ra cÃ¡c gá»£i Ã½ cá»¥ thá»ƒ! MÃ£ nguá»“n chá»©a cÃ¡c phÃ¢n tÃ­ch dá»¯ liá»‡u mÃ´ phá»ng cÃ³ thá»ƒ Ä‘Æ°á»£c ná»™p cÃ¹ng vá»›i viá»‡c Ä‘Äƒng kÃ½ trÆ°á»›c hoáº·c bÃ¡o cÃ¡o Ä‘Ã£ Ä‘Äƒng kÃ½ Ä‘á»ƒ cÃ¡c nhÃ  pháº£n biá»‡n hiá»ƒu rÃµ chÃ­nh xÃ¡c cÃ¡c phÃ¢n tÃ­ch báº¡n dá»± Ä‘á»‹nh thá»±c hiá»‡n. Khi báº¡n cÃ³ dá»¯ liá»‡u thá»±c táº¿, báº¡n chá»‰ cáº§n cáº¯m chÃºng vÃ o mÃ£ nÃ y vÃ  ngay láº­p tá»©c cÃ³ káº¿t quáº£ cá»§a cÃ¡c phÃ¢n tÃ­ch xÃ¡c nháº­n!

### PhÃ¢n loáº¡i:

Theo lá»‹ch sá»± phÃ¡t triá»ƒn, *simulation* cÃ³ thá»ƒ Ä‘Æ°á»£c chia thÃ nh cÃ¡c phÃ¢n lá»›p nhÆ° sau:

```{=html}
<div style="text-align: center; margin-bottom: 20px;">
  <img src="img/simulationmodel.png" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
  
  <!-- Picture Name -->
  <div style="text-align: left; margin-top: 10px;">
    HÃ¬nh 2: PhÃ¢n nhÃ¡nh cá»§a simulation
  </div>
  
  <!-- Source Link -->
  <div style="text-align: right; font-style: italic; margin-top: 5px;">
    Source: <a href="https://softwaresim.com/blog/types-of-simulation-models-choosing-the-right-approach-for-your-simulation-project/" target="_blank">Link to Image</a>
  </div>
</div>
```
Trong Ä‘Ã³:

-   2 nhÃ¡nh lá»›n lÃ  *Deterministic* vs *Stochastic*: sá»± khÃ¡c nhau rÃµ rÃ ng nháº¥t chÃ­nh lÃ  *outcome* cá»§a 2 mÃ´ hÃ¬nh nÃ y. Äá»‘i vá»›i *Deterministic* thÃ¬ *outcome* hoÃ n toÃ n dá»± Ä‘oÃ¡n Ä‘Æ°á»£c, vÃ­ dá»¥ vá»›i 1 lÆ°á»£ng thÃ´ng tin Ä‘áº§u vÃ o nhÆ° hÃ¬nh dáº¡ng tay chÃ¢n, kÃ­ch thÆ°á»›c, mÃ u sáº¯c,... thÃ¬ káº¿t quáº£ cuá»‘i cÃ¹ng lÃ  phÃ¢n biá»‡t Ä‘Æ°á»£c Ä‘Ã¢u lÃ  hÃ¬nh áº£nh cá»§a con chÃ³ hoáº·c con mÃ¨o vÃ  quan trá»ng lÃ  khÃ´ng cÃ³ *randomness* tá»« mÃ´ hÃ¬nh - nghÄ©a lÃ  káº¿t quáº£ chá»‰ cÃ³ lÃ  con chÃ³ hoáº·c con mÃ¨o. CÃ²n vá»›i *Stochastic* thÃ¬ thÃ´ng tin Ä‘áº§u vÃ o sáº½ khÃ´ng rÃµ rÃ ng nhÆ° *Deterministic* - cÃ³ thá»ƒ lÃ  do sai lá»‡ch tá»« viá»‡c Ä‘o lÆ°á»ng hoáº·c do chÆ°a Ä‘á»§ thÃ´ng tin nÃªn *outcome* cá»§a nÃ³ cÅ©ng náº±m trong 1 khoáº£ng hoáº·c 1 táº­p há»£p cÃ¡c giÃ¡ trá»‹ kháº£ thi.

-   2 nhÃ¡nh nhá» lÃ  *Static* vs *Dynamic*: mÃ´ hÃ¬nh *Static* thÃ¬ diá»…n táº£ má»™t quÃ¡ trÃ¬nh mÃ´ phá»ng táº¡i 1 Ä‘iá»ƒm, 1 má»‘c thá»i gian cá»¥ thá»ƒ vÃ  mÃ´ hÃ¬nh *Dynamic* cÅ©ng diá»…n táº£ nhÆ° váº­y nhÆ°ng quÃ¡ trÃ¬nh mÃ´ phá»ng thay Ä‘á»•i theo thá»i gian. TiÃªu biá»ƒu cá»§a *Static* lÃ  phÆ°Æ¡ng phÃ¡p *Monte Carlo* dá»±a trÃªn ná»n táº£ng vá» *random sampling*.

## CÃ¡c mÃ´ hÃ¬nh thÃ´ng dá»¥ng trong Supply Chain Simulation:

á»¨ng dá»¥ng cá»§a **Simulation** trong *Supply chain* lÃ  ráº¥t nhiá»u, Ä‘áº·c biá»‡t á»Ÿ phÃ¢n máº£ng *planning*. Viá»‡c giáº£ láº­p trÆ°á»›c cÃ¡c trÆ°á»ng há»£p, tÃ¬nh huá»‘ng cÃ³ thá»ƒ gáº·p pháº£i lÃ  quan trá»ng vÃ  nÃ³ giÃºp ngÆ°á»i quáº£n lÃ­ Ä‘Æ°a ra Ä‘Æ°á»£c cÃ¡c phÆ°Æ¡ng Ã¡n thay tháº¿ hoáº·c phÆ°Æ¡ng Ã¡n *backup* Ä‘á»ƒ Ä‘áº£m báº£o chuá»—i cung á»©ng hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng.

RiÃªng trong ngÃ nh Supply Chain thÃ¬ cÃ¡c mÃ´ hÃ¬nh Ä‘Æ°á»£c sá»­ dá»¥ng nhiá»u nháº¥t bao gá»“m: *DES - Discrete Event Simulation* vÃ  *ABM - Agent Based Modeling*.

```{=html}
<div style="text-align: center; margin-bottom: 20px;">
  <img src="img/simulation.png" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
  
  <!-- Picture Name -->
  <div style="text-align: left; margin-top: 10px;">
    HÃ¬nh 3: CÃ¡c mÃ´ hÃ¬nh phá»• biáº¿n trong ngÃ nh Supply Chain
  </div>
  
  <!-- Source Link -->
  <div style="text-align: right; font-style: italic; margin-top: 5px;">
    Source: <a href="https://www.supplychaindataanalytics.com/simulation-methods-for-scm-analysts/" target="_blank">Link to Image</a>
  </div>
</div>
```
-   *DES*: hÆ°á»›ng tá»›i mÃ´ hÃ¬nh hÃ³a quy trÃ¬nh hoáº¡t Ä‘á»™ng cá»§a Ä‘á»‘i tÆ°á»£ng, tá»±a nhÆ° flowchart cá»§a process mÃ  báº¡n cÃ³ thá»ƒ há»c trong quáº£n trá»‹ váº­n hÃ nh. VÃ­ dá»¥ quÃ¡ trÃ¬nh váº­n chuyá»ƒn hÃ ng tá»« khi cÃ³ Ä‘Æ¡n bao gá»“m: KH Ä‘áº·t hÃ ng -\> CS nháº­n Ä‘Æ¡n vÃ  thÃ´ng bÃ¡o -\> WH nháº­n thÃ´ng tin Ä‘Æ¡n hÃ ng vÃ  chuáº©n bá»‹ hÃ ng -\> WH giao hÃ ng cho Shipper -\> Shipper váº­n chuyá»ƒn Ä‘áº¿n táº­n nhÃ  hoáº·c tá»›i DC -\> KH nháº­n hÃ ng tá»« shipper hoáº·c ra DC láº¥y.

Váº­y dá»±a vÃ o cÃ¡c Ä‘áº·c tÃ­nh Ä‘Ã³, *DES* cÃ³ thá»ƒ giÃºp báº¡n tráº£ lá»i cÃ¡c cÃ¢u há»i nhÆ°: Khi nÃ o xe chá»Ÿ hÃ ng? ETA vÃ  ETD cá»¥ thá»ƒ bao nhiÃªu ?, ...

```{=html}
<div style="text-align: center; margin-bottom: 20px;">
  <img src="img/DESmodel.png" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
  
  <!-- Picture Name -->
  <div style="text-align: left; margin-top: 10px;">
    HÃ¬nh 4:  MÃ´ hÃ¬nh DES trong dá»± bÃ¡o nhu cáº§u cho Volvo
  </div>
  
  <!-- Source Link -->
  <div style="text-align: right; font-style: italic; margin-top: 5px;">
    Source: <a href="https://www.diva-portal.org/smash/get/diva2:1465779/FULLTEXT02" target="_blank">Link to Image</a>
  </div>
</div>
```
NhÆ° hÃ¬nh trÃªn nÃ y lÃ  1 á»©ng dá»¥ng *DES* vÃ o viá»‡c dá»± bÃ¡o nhu cáº§u khÃ¡ch hÃ ng cá»§a Volvo trong nghiÃªn cá»©u cá»§a [@jagathishvarjayakumar2020].

-   *ABM*: lÃ  mÃ´ hÃ¬nh dá»±a vÃ o *behaviors - hÃ nh vi* cá»§a tá»«ng object vÃ  Ä‘Æ°a chÃºng vÃ o *enviroment* Ä‘á»ƒ tá»± tÆ°Æ¡ng tÃ¡c vÃ  thu láº¡i dá»¯ liá»‡u. Vá» lÃ­ thuyáº¿t,*ABM* sáº½ chi tiáº¿t vÃ  Ä‘Ã¡nh giÃ¡ kÄ© hÆ¡n *DES* nÃªn Ä‘Ã³ cÅ©ng lÃ  lÃ½ do *ABM* Ä‘Æ°á»£c Æ°u tiÃªn sá»­ dá»¥ng trong thá»i gian gáº§n Ä‘Ã¢y nhÆ°ng Ä‘iá»u nÃ y cÅ©ng Ä‘Ã²i há»i Ä‘á»™ chÃ­nh xÃ¡c cao vá» dá»¯ liá»‡u Ä‘áº§u vÃ o Ä‘á»ƒ trÃ¡nh sá»± sai lá»‡ch do Ä‘á»™ nháº¡y cáº£m cao cá»§a mÃ´ hÃ¬nh nÃ y. CÃ²n trÃªn thá»±c táº¿, mÃ´ hÃ¬nh nÃ o tá»‘t hÆ¡n cÃ²n tÃ¹y vÃ o trÆ°á»ng há»£p mÃ  báº¡n Ä‘á»‘i máº·t.

Má»™t vÃ­ dá»¥ thá»±c táº¿ cá»§a mÃ´ hÃ¬nh *ABM* lÃ  trong nghiÃªn cá»©u [@hiroyasuinoue2023] vá» giáº£ láº­p sá»± tÃ¡c Ä‘á»™ng cá»§a tráº­n Ä‘á»™ng Ä‘áº¥t [GEJE](https://en.wikipedia.org/wiki/2011_T%C5%8Dhoku_earthquake_and_tsunami) ná»•i tiáº¿ng tá»«ng cáº£n quáº¿t Nháº­t Báº£n Ä‘áº¿n hoáº¡t Ä‘á»™ng sáº£n xuáº¥t cá»§a cÃ´ng ty.

```{=html}
<div style="text-align: center; margin-bottom: 20px;">
  <img src="img/ABMmodel.png" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
  
  <!-- Picture Name -->
  <div style="text-align: left; margin-top: 10px;">
    HÃ¬nh 5: MÃ´ hÃ¬nh ABM dá»± bÃ¡o sá»± máº¥t mÃ¡t kinh táº¿ do áº£nh hÆ°á»Ÿng bá»Ÿi GEJE
  </div>
  
  <!-- Source Link -->
  <div style="text-align: right; font-style: italic; margin-top: 5px;">
    Source: <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0288062" target="_blank">Link to Image</a>
  </div>
</div>
```
MÃ´ hÃ¬nh trÃªn Ä‘Ã£ giáº£ láº­p sá»± máº¥t mÃ¡t vá» kinh táº¿ (*economic loss*) gÃ¢y bá»Ÿi *supply chain disruption* theo thá»i gian tÃ­nh tá»« lÃºc cÆ¡n Ä‘á»™ng Ä‘áº¥t xáº£y ra. Äá»“ng thá»i káº¿t quáº£ cÅ©ng cho tháº¥y sá»± khÃ¡c biá»‡t so vá»›i nghiÃªn cá»©u trÆ°á»›c Ä‘Ã¢y vÃ  lÃ½ do cá»§a sá»± chÃªnh lá»‡ch nÃ y lÃ  viá»‡c máº¥t Ä‘iá»‡n kÃ©o dÃ i áº£nh hÆ°á»Ÿng náº·ng Ä‘áº¿n hoáº¡t Ä‘á»™ng sáº£n xuáº¥t vÃ  gÃ¢y tá»•n tháº¥t cho ngÃ nh sáº£n xuáº¥t Nháº­t Báº£n.

NhÆ° váº­y, cÃ¡c báº¡n cÃ³ thá»ƒ tháº¥y tÃ­nh á»©ng dá»¥ng cao cá»§a *simulation* trong Ä‘á»i thá»±c. Äá»‘i vá»›i cÃ¡c bÃ i toÃ¡n thá»±c táº¿, tÃ¹y vÃ o má»©c Ä‘á»™ phá»©c táº¡p, ngÆ°á»i dÃ¹ng cÃ³ thá»ƒ Æ°u tiÃªn *ABM* hay *DES* hoáº·c cÃ³ thá»ƒ phá»‘i há»£p cáº£ hai thuáº­t toÃ¡n nÃ y.

Váº­y Ä‘á»ƒ viá»‡c *simulation* diá»…n ra tá»‘t, mÃ¬nh sáº½ cáº­p nháº­p thÃªm cÃ¡c kiáº¿n thá»©c sau Ä‘Ã¢y.

### LÃ½ thuyáº¿t hÃ ng chá»:

Äáº§u tiÃªn lÃ  *Queueing* hay cÃ²n gá»i lÃ  hÃ ng chá» lÃ  má»™t chuá»—i cÃ¡c Ä‘á»‘i tÆ°á»£ng Ä‘ang chá» Ä‘á»£i Ä‘Æ°á»£c phá»¥c vá»¥ vÃ  hoÃ n thÃ nh yÃªu cáº§u cá»§a mÃ¬nh tá»« cÃ¡c *server* trong há»‡ thá»‘ng. NÃ³i má»™t cÃ¡ch Ä‘Æ¡n giáº£n lÃ  giá»‘ng nhÆ° báº¡n Ä‘i mua trÃ  sá»¯a vÃ  Ä‘ang Ä‘á»©ng chá» tá»›i lÆ°á»£t mÃ¬nh Ä‘á»ƒ order, sau Ä‘Ã³ Ä‘á»£i trÃ  sá»¯a Ä‘Æ°á»£c lÃ m xong vÃ  láº¥y trÃ  sá»¯a vÃ  trá»Ÿ vá» nhÃ . Vá»›i gÃ³c nhÃ¬n cá»§a khÃ¡ch hÃ ng thÃ¬ khÃ´ng ai muá»‘n chá» Ä‘á»£i, cÃ²n gÃ³c nhÃ¬n cá»§a chá»§ cá»­a hÃ ng thÃ¬ khÃ´ng muá»‘n hÃ ng chá» pháº£i dÃ i (máº·c dÃ¹ nhÆ° váº­y Ä‘á»“ng nghÄ©a vá»›i cá»­a hÃ ng Ä‘ang Ä‘Ã´ng khÃ¡ch nhÆ°ng hÃ ng chá» dÃ i sáº½ lÃ m khÃ³ chá»‹u khÃ¡ch hÃ ng vÃ  dáº«n Ä‘áº¿n máº¥t khÃ¡ch).

```{=html}
<div style="text-align: center; margin-bottom: 20px;">
  <img src="img/step.png" style="max-width: 100%; height: auto; display: block; margin: 0 auto;">
  
  <!-- Picture Name -->
  <div style="text-align: left; margin-top: 10px;">
    HÃ¬nh 6: VÃ­ dá»¥ vá» queueing trong quáº£n lÃ­ nhÃ  kho
  </div>
  
  <!-- Source Link -->
  <div style="text-align: right; font-style: italic; margin-top: 5px;">
    Source: <a href="https://chatgpt.com/" target="_blank">Link to Image</a>
  </div>
</div>
```
NhÆ° váº­y, má»¥c tiÃªu lÃ : Ä‘áº£m báº£o hÃ ng chá» á»Ÿ má»©c **tá»‘i Æ°u nháº¥t** Ä‘á»ƒ cÃ¢n báº±ng giá»¯a cáº¥p Ä‘á»™ phá»¥c vá»¥ (Vd: Ä‘áº£m báº£o khÃ¡ch hÃ ng hÃ i lÃ²ng) vÃ  chi phÃ­. LÃ½ do vÃ¬ sao mÃ¬nh nÃ³i ráº±ng lÃ  **tá»‘i Æ°u nháº¥t** chá»© khÃ´ng pháº£i lÃ  giáº£m tá»›i má»©c hÃ ng chá» = 0 lÃ  vÃ¬ hÃ ng chá» luÃ´n luÃ´n tá»“n táº¡i cho dÃ¹ báº¡n cÃ³ tá»‘n bao nhiÃªu tÃ i nguyÃªn vÃ o *server*. NÃ³ giá»‘ng nhÆ° nghá»‹ch lÃ½ quy hoáº¡ch Ä‘Ã´ thá»‹ ráº±ng: "XÃ¢y thÃªm Ä‘Æ°á»ng sáº½ khÃ´ng giáº£m káº¹t xe" VÃ  nghá»‹ch lÃ½ váº­n táº£i: ÄÆ°á»ng cÃ ng rá»™ng thÃ¬ cÃ ng káº¹t xe" cá»§a [Matthew A. Turner](https://vivo.brown.edu/display/mturner1) vÃ  [Gilles Duranton](https://knowledge.wharton.upenn.edu/faculty/gilles-duranton/), nghÄ©a lÃ  báº¡n chá»‰ giáº£m khoáº£ng cÃ¡ch cá»§a hÃ ng káº¹t xe chá»© khÃ´ng hoÃ n toÃ n xÃ³a bá» tÃ¬nh tráº¡ng káº¹t xe. VÃ¬ váº­y, vÃ­ dá»¥ náº¿u cá»­a hÃ ng cá»§a báº¡n luÃ´n tá»“n táº¡i hÃ ng chá» cá»¡ 5-6 ngÆ°á»i/hÃ ng thÃ¬ báº¡n chá»‰ cáº§n thuÃª thÃªm 1 nhÃ¢n viÃªn Ä‘á»©ng trá»±c lÃ  hÃ ng chá» giáº£m cÃ²n 2-3 ngÆ°á»i thay vÃ¬ 5 nhÃ¢n viÃªn Ä‘á»ƒ hÃ ng chá» giáº£m cÃ²n 0 bá»Ÿi nhÆ° váº­y lÃ  tá»‘n chi phÃ­ vÃ  khÃ´ng hiá»‡u quáº£.

Váº­y lÃ m sao Ä‘á»ƒ xÃ¢y dá»±ng mÃ´ hÃ¬nh hÃ ng chá» cho cá»­a hÃ ng cá»§a báº¡n ? Äáº§u tiÃªn ta cáº§n xÃ¡c Ä‘á»‹nh Ä‘Æ°á»£c lÆ°á»£ng khÃ¡ch hÃ ng trong má»™t khoáº£ng thá»i gian cá»¥ thá»ƒ (Vd: ngÃ y, tuáº§n, thÃ¡ng,...) tuÃ¢n theo phÃ¢n bá»‘ gÃ¬, trong Ä‘Ã³ cÃ¡c phÃ¢n bá»‘ nhÆ° phÃ¢n phá»‘i hÃ m mÅ©, phÃ¢n phá»‘i Poisson Ä‘Æ°á»£c sá»­ dá»¥ng phá»• biáº¿n.

```{r}
#| warning: false
#| message: false
# Load necessary library
set.seed(123)  

# Define customer flow pattern for different times of the day
# Morning rush: 8:30 AM - 10:30 AM
# Midday: 10:30 AM - 2:00 PM
# Afternoon: 2:00 PM - 4:30 PM
# Evening rush: 4:30 PM - 7:00 PM
# Late evening: 7:00 PM - 10:00 PM

# Function to generate number of customers based on time of day
generate_customers <- function(time) {
  hour <- as.numeric(format(time, "%H"))
  
  if (hour >= 8 && hour < 10) {
    # Morning rush (8:30 AM - 10:30 AM)
    return(sample(20:35, 1))  # 20 to 35 customers
  } else if (hour >= 10 && hour < 14) {
    # Midday (10:30 AM - 2:00 PM)
    return(sample(20:32, 1))  # 20 to 32 customers
  } else if (hour >= 14 && hour < 16) {
    # Afternoon slump (2:00 PM - 4:30 PM)
    return(sample(10:18, 1))  # 10 to 18 customers
  } else if (hour >= 16 && hour < 19) {
    # Evening rush (4:30 PM - 7:00 PM)
    return(sample(30:50, 1))  # 30 to 50 customers
  } else if (hour >= 19 && hour <= 22) {
    # Late evening (7:00 PM - 10:00 PM)
    return(sample(12:18, 1))  # 12 to 18 customers
  }
}

time_intervals<-seq(from = as.POSIXct("2024-11-11 08:30:00",tz = "UTC"),

                    to = as.POSIXct("2024-11-11 22:00:00",tz = "UTC"),

                    by = "30 min")

# Apply the function to generate customer data for each time interval
customer_data <- sapply(time_intervals, generate_customers)

# Create a data frame with time and customer count
coffee_data <- data.frame(
  Time = as.numeric(time_intervals)*1000,
  Customers = customer_data
)

library(highcharter)
hchart(
  coffee_data,
  'line', 
  hcaes(y = Customers,
        x = Time)
  ) |> 
  hc_xAxis(title = FALSE,type = "datetime") |> 
  hc_yAxis(
    title = list(text = "Number of Customers")
  ) |> 
  hc_title(text = "No.Customer through a normal day in Coffee Shop")
```

CÃ¡ch xÃ¡c Ä‘á»‹nh lÃ  chia lÆ°á»£ng ngÆ°á»i vÃ o cá»­a hÃ ng theo tá»«ng khoáº£ng thá»i gian báº±ng nhau, nhÆ° trÃªn vÃ­ dá»¥ Ä‘Ã¢y lÃ  30 phÃºt trong khoáº£ng thá»i gian hoáº¡t Ä‘á»™ng tá»« 8h00 AM Ä‘áº¿n 22h00 PM. Káº¿t quáº£ kiá»ƒm Ä‘á»‹nh Ä‘Æ°á»£c trÃ¬nh bÃ y bÃªn dÆ°á»›i vá»›i giÃ¡ trá»‹ p \< 0.05 cho tháº¥y sá»‘ lÆ°á»£ng khÃ¡ch hÃ ng tuÃ¢n theo phÃ¢n bá»‘ poisson (Máº·c dÃ¹ dá»¯ liá»‡u nÃ y Ä‘Æ°á»£c mÃ¬nh táº¡o ngáº«u nhiÃªn bá»Ÿi chatGPT ğŸ˜®ğŸ˜®ğŸ˜®).

```{r}
#| warning: false
#| message: false
#| include: false
# Table of observed frequencies
obs_freq <- table(coffee_data$Customers)
# Expected frequencies based on Poisson distribution
lambda <- mean(coffee_data$Customers)
exp_freq <- dpois(as.numeric(names(obs_freq)), lambda) * length(data)

# Perform Chi-squared test
result <- chisq.test(obs_freq, p = exp_freq, rescale.p = TRUE)

# Create a data frame for gt()
result_df <- data.frame(
  Metric = c("Chi-squared Statistic", 
             "Degrees of Freedom", "p-value"),
  Value = c(round(result$statistic,4), 
            result$parameter, 
            format(result$p.value, 
                   scientific = TRUE, 
                   digits = 2))
)

counts_df <- data.frame(
Category = as.numeric(names(obs_freq)),
Observed = as.vector(obs_freq),
`P-value` = round(exp_freq,4)
)
```

::: panel-tabset
### Count table:

```{r}
#| warning: false
#| message: false
library(gt)
# Print Observed vs. Expected Counts Table
gt(counts_df) %>%
  tab_header(
    title = "Observed Counts vs P-value"
  ) %>%
  tab_spanner(
    label = "Counts",
    columns = c("Observed", "P.value")
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(columns = everything())
  )
```

### Chi-squared test:

```{r}
# Print Chi-squared Test Results Table
gt(result_df) %>%
  tab_header(
    title = "Chi-squared Test Results"
  ) %>%
  tab_spanner(
    label = "Test Statistics",
    columns = c("Value")
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_column_labels(columns = everything())
  )
```
:::

Tiáº¿p theo lÃ  xÃ¡c Ä‘á»‹nh nÄƒng suáº¥t cá»§a *server* trong 1 Ä‘Æ¡n vá»‹ thá»i gian. Giáº£ sá»­ nhÃ¢n viÃªn cá»§a báº¡n cÃ³ nÄƒng suáº¥t lÃ  nhÆ° nhau vÃ  phá»¥c vá»¥ trung bÃ¬nh Ä‘Æ°á»£c 1 Ä‘Æ¡n hÃ ng/10 phÃºt hay 6 Ä‘Æ¡n hÃ ng/giá» thÃ¬ ta cÃ³ $\mu$ = 6

Sau Ä‘Ã³ chÃºng ta sáº½ báº¯t Ä‘áº§u quÃ¡ trÃ¬nh giáº£ láº­p vÃ  báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng 2 cÃ¡ch: (i) PhÆ°Æ¡ng phÃ¡p giáº£i tÃ­ch (giáº£i phÆ°Æ¡ng trÃ¬nh toÃ¡n há»c báº±ng tay) hoáº·c (ii) PhÆ°Æ¡ng phÃ¡p mÃ¡y tÃ­nh (giáº£ láº­p báº±ng mÃ¡y). Vá»›i **R** thÃ¬ báº¡n hoÃ n toÃ n lÃ m Ä‘iá»u nÃ y dá»… hÆ¡n.

```{r}
#| include: false
#| warning: false
#| message: false
library(simmer)
simulate_shop <- function(employee) {
  labor_capacity <- 12 / 60  # Service rate per minute
  
  # Initialize the simulation
  sim <- simmer("CoffeeShop")
  
  # Define the customer process
  customer_process <- trajectory("customer") %>%
    seize("barista", 1) %>%
    timeout(function() rexp(1, rate = labor_capacity)) %>%
    release("barista", 1)
  
  # Add barista resource to the simulation
  sim <- sim %>%
    add_resource("barista", capacity = employee)
  
  # Schedule customer arrivals
  start_time <- as.numeric(time_intervals[1])  # Convert start time to POSIX numeric

  customer_id <- 1  # Initialize a counter for unique customer naming

  for (j in 1:length(customer_data)) {
    num_customers <- customer_data[j]
    interval_start <- as.numeric(time_intervals[j])  # Start of each 30-min interval in POSIX numeric

    for (k in 1:num_customers) {
      arrival_offset <- runif(1, 0, 1800)  # Random arrival within 30 mins
      arrival_time <- interval_start + arrival_offset  # Actual arrival time in POSIX numeric
      
      # Convert to relative time (in minutes) from start_time
      relative_arrival <- (arrival_time - start_time) / 60
      
      # Generate a unique name for each customer
      customer_name <- paste0("customer_", customer_id)
      customer_id <- customer_id + 1  # Increment the unique ID
      
      # Add customer generator with a unique name
      sim <- sim %>%
        add_generator(customer_name, 
                      customer_process, 
                      at(relative_arrival))
    }
  }
  
  # Run the simulation from 8:30 AM to 10:00 PM means 28 periods of 30 minutes
  sim %>% 
    run(until = (22 - 8) * 2 * 60)
  
  return(sim)
}

sim2<-simulate_shop(2)
sim3<-simulate_shop(3)
sim4<-simulate_shop(4)
```

::: panel-tabset
### 2 employee:

```{r}
#| echo: false
arrival_data <- sim2  %>%
get_mon_arrivals() 

arrival_data<-arrival_data |> 
  dplyr::select(c(start_time,
           end_time,
           activity_time)) |> 
  pivot_longer(cols = everything(),
               values_to = "time",
               names_to = "type")
highcharter::hchart(
  arrival_data,
  'line', 
  hcaes(y = time, 
        group = type)
) |> 
  hc_tooltip(
    pointFormat = '{point.x: %Y-%m-%d} ',
    headerFormat = '',
    useHTML = TRUE,
    formatter = JS(
      "function() {
         var baseTime = Date.parse('2024-11-11 08:30:00 UTC'); // Base time
         var timeOffset = this.y * 60000; // Convert minutes to milliseconds
         var calculatedTime = new Date(baseTime + timeOffset);
         return '<b>' + this.series.name + '</b><br>' +
                'Time: ' + Highcharts.dateFormat('%Y-%m-%d %H:%M:%S UTC', calculatedTime);
       }"
    )
  )
```

### 3 employee:

```{r}
#| echo: false
library(highcharter)
arrival_data <- sim3 %>%
  get_mon_arrivals() 

arrival_data<-arrival_data |> 
  dplyr::select(c(start_time,
           end_time,
           activity_time)) |> 
  pivot_longer(cols = everything(),
               values_to = "time",
               names_to = "type")
hchart(
  arrival_data,
  'line', 
  hcaes(y = time, group = type)
) |> 
  hc_tooltip(
    pointFormat = '{point.x: %Y-%m-%d} ',
    headerFormat = '',
    useHTML = TRUE,
    formatter = JS(
      "function() {
         var baseTime = Date.parse('2024-11-11 08:30:00 UTC'); // Base time
         var timeOffset = this.y * 60000; // Convert minutes to milliseconds
         var calculatedTime = new Date(baseTime + timeOffset);
         return '<b>' + this.series.name + '</b><br>' +
                'Time: ' + Highcharts.dateFormat('%Y-%m-%d %H:%M:%S UTC', calculatedTime);
       }"
    )
  )
```

### 4 employee:

```{r}
#| echo: false
arrival_data <- sim4  %>%
  get_mon_arrivals()
  
library(highcharter)
arrival_data |> 
  dplyr::select(c(start_time,
           end_time,
           activity_time)) |> 
  pivot_longer(cols = everything(),
               values_to = "time",
               names_to = "type") |> 
  hchart(
  'line', 
  hcaes(y = time,
        group = type)
  ) |> 
   hc_tooltip(
    pointFormat = '{point.x: %Y-%m-%d} ',
    headerFormat = '',
    useHTML = TRUE,
     formatter = JS(
      "function() {
         var baseTime = Date.parse('2024-11-11 08:30:00 UTC'); // Base time
         var timeOffset = this.y * 60000; // Convert minutes to milliseconds
         var calculatedTime = new Date(baseTime + timeOffset);
         return '<b>' + this.series.name + '</b><br>' +
                'Time: ' + Highcharts.dateFormat('%Y-%m-%d %H:%M:%S UTC', calculatedTime);
       }"
    )
  )
```
:::

Káº¿t quáº£ cho tháº¥y cá»­a hÃ ng nÃªn thuÃª 4 ngÆ°á»i Ä‘á»ƒ Ä‘áº£m báº£o *server level* á»Ÿ dáº¡ng cao. Náº¿u cá»­a hÃ ng chá»‰ thuÃª 2 ngÆ°á»i thÃ¬ thá»i gian Ä‘á»£i phá»¥c vá»¥ trung bÃ¬nh cá»§a khÃ¡ch hÃ ng lÃ  khoáº£ng **7.5 tiáº¿ng** (Má»™t con sá»‘ hÆ¡i khá»§ng, tÆ°á»Ÿng Ä‘ang sá»­ dá»¥ng dá»‹ch vá»¥ cá»§a Vietjet cÆ¡! ğŸ˜„ğŸ˜„ğŸ˜„) trong khi náº¿u thuÃª thÃªm 2 ngÆ°á»i thÃ¬ giáº£m xuá»‘ng cÃ²n **41.5 phÃºt** \~ giáº£m thá»i gian chá» Ä‘á»£i xuá»‘ng **11 láº§n**.

### LÃ½ thuyáº¿t thá»‘ng kÃª:

Tiáº¿p theo, báº¡n cáº§n lÃ½ thuyáº¿t thá»‘ng kÃª vá» chuyÃªn ngÃ nh cá»§a váº¥n Ä‘á» mÃ  báº¡n Ä‘ang mong muá»‘n mÃ´ hÃ¬nh hÃ³a. Viá»‡c xÃ¡c Ä‘á»‹nh cÃ¡c Ä‘á»‘i tÆ°á»£ng trong *server* vÃ  Ä‘á»‘i tÆ°á»£ng má»¥c tiÃªu cáº§n giáº£ láº­p cÅ©ng nhÆ° cÃ¡c Ä‘áº·c tÃ­nh cáº§n cÃ³ trong mÃ´ hÃ¬nh lÃ  quan trá»ng bá»Ÿi chÃºng lÃ  sÆ°á»n sá»‘ng cá»§a mÃ´ hÃ¬nh giáº£ láº­p. VÃ­ dá»¥ nhÆ° quy trÃ¬nh hoáº¡t Ä‘á»™ng cá»§a quÃ¡n cafe lÃ  nhÆ° tháº¿ nÃ o, sáº½ hoáº¡t Ä‘á»™ng ra sao trong nhiá»u trÆ°á»ng há»£p,... cÃ ng rÃµ thÃ¬ viá»‡c giáº£ láº­p cÃ ng sÃ¡t vá»›i thá»±c táº¿.

Äáº·c biá»‡t vá»›i cÃ¡c ngÃ nh vá» y sinh há»c, giáº£ láº­p quáº§n thá»ƒ lÃ  cÃ´ng viá»‡c háº±ng ngÃ y cá»§a cÃ¡c nghiÃªn cá»©u sinh nÃªn viá»‡c hiá»ƒu rÃµ báº£n cháº¥t cá»§a quáº§n thá»ƒ Ä‘Ã³ quan trá»ng hÆ¡n cÃ¡ch thá»©c hay phÆ°Æ¡ng phÃ¡p giáº£ láº­p.

Vá» code, báº¡n cáº§n lÆ°u Ã½ ráº±ng *sample size - sá»‘ lÆ°á»£ng máº«u* áº£nh hÆ°á»Ÿng lá»›n Ä‘áº¿n Ä‘á»™ chÃ­nh xÃ¡c (*precision*) cá»§a Ä‘o lÆ°á»ng áº£nh hÆ°á»Ÿng cá»§a biáº¿n Ä‘Ã³. Äiá»u nÃ y cÅ©ng tÆ°Æ¡ng tá»± vá»›i Ä‘á»™ láº·p láº¡i (*replication*) nghÄ©a lÃ  báº¡n láº·p láº¡i nhiá»u láº§n viá»‡c tÃ­nh toÃ¡n thÃ¬ káº¿t quáº£ sáº½ tá»‘t hoáº·c chÃ­nh xÃ¡c hÆ¡n.

Tiáº¿p theo, ta sáº½ thá»±c hÃ nh trong R.
