"0","#| warning: false"
"0","#| message: false"
"0","#| echo: true"
"0","library(simmer)"
"0","set.seed(1234)"
"0","# Define the trajectory for the vehicle's process"
"0","vehicle_traj <- trajectory(""Vehicle Process"") %>%"
"0","  # Step 1: Take Order"
"0","  timeout(function() rnorm(n=1, mean = 30, sd = 3)) %>% # Time to take an order"
"0","  "
"0","  # Step 2: Check if goods are available in the warehouse"
"0","  seize(""warehouse"", 1) %>%  "
"0","  timeout(function() rexp(1, 0.3)) %>%  # Time to check if goods are available"
"0","  release(""warehouse"", 1) %>%  # Release the warehouse resource after checking"
"0","  "
"0","  # Step 3: If goods are not available, wait for manufacturing (conditional)"
"0","  branch("
"0","    option = function() ifelse(runif(1) < 0.5, 1, 2),  # 50% chance"
"0","    continue = c(TRUE, TRUE),"
"0","    trajectory() %>% "
"0","      timeout(function() rexp(1, 0.8)),  # Manufacturing time if goods aren't available"
"0","    "
"0","    trajectory(""WaitForStock"")  # Second branch if goods are available"
"0","  ) %>%"
"0","  "
"0","  # Step 4: Loading the goods"
"0","  seize(""truck"", 1) %>%  # Seize one truck for loading"
"0","  timeout(function() rexp(1, 0.6)) %>%  # Loading time"
"0","  release(""truck"", 1) %>%  # Release truck after loading"
"0","  "
"0","  # Step 5: Transport to store"
"0","  timeout(function() rexp(1, 1)) %>%  # Transport time"
"0","  "
"0","  # Step 6: Unload the goods at the store"
"0","  seize(""store"", 1) %>%  # Seize one store resource for unloading"
"0","  timeout(function() rexp(1, 0.4)) %>%  # Unloading time"
"0","  release(""store"", 1)  # Release store resource"
"0",""
"0","# Create an environment"
"0","env <- simmer(""Vehicle Simulation"") %>%"
"0","  add_resource(""warehouse"", capacity = 1) %>%  "
"0","  add_resource(""truck"", capacity = 1) %>%  "
"0","  add_resource(""store"", capacity = 1) %>%  "
"0","  "
"0","  # Add generator for vehicles arriving with an exponential inter-arrival time"
"0","  add_generator(""vehicle"", vehicle_traj, function() rexp(1, 0.1))  # Average of 10 vehicles per 100 time units"
"0",""
"0","# Run the simulation for a longer duration"
"0","env %>% "
"0","  run(until = 500)"
"1","simmer environment: Vehicle Simulation | now: 500 | next: 506.640269258215
{ Monitor: in memory }
"
"1","{ Resource: warehouse | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }
"
"1","{ Resource: truck | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }
"
"1","{ Resource: store | monitored: TRUE | server status: 0(1) | queue status: 0(Inf) }
"
"1","{ Source: vehicle | monitored: 1 | n_generated: 45 }
"
"0","start_time <- as.POSIXct(""2024-11-09 08:30:00"", "
"0","                         format=""%Y-%m-%d %H:%M:%S"")"
"0",""
"0","arrivals<-get_mon_arrivals(env, per_resource = T)"
"0","arrivals$datetime <- start_time + (arrivals$start_time * 60)  "
"0","arrivals$finish_datetime <- start_time + (arrivals$end_time * 60)  "
