---
title: "Practice in R"
subtitle: "Vi·ªát Nam, 2024"
categories: ["SupplyChainManagement", "Simulation","Agent Based Modeling"]
description: "C√°ch th·ª±c h√†nh trong R"
author: "Cao Xu√¢n L·ªôc"
date: "2024-11-13"
title-block-banner: img/mountain.jpg
title-block-banner-color: "white"
format: 
  html:
    code-fold: true
    code-tools: true
bibliography: references.bib
---

```{r}
#| include: false
#| message: false
#| warning: false
pacman::p_load(
janitor,
tidyverse,
dplyr,
tidyr,
magrittr,
shiny,
leaflet,
reactable,
leaflet.extras,
ggplot2,
quarto,
reactablefmtr
)
```

## Th·ª±c h√†nh trong R:

### Th∆∞ vi·ªán:

TI·∫øp theo l√† ch√∫ng ta s·∫Ω l·∫≠p th·ª≠ *DES* trong **R** ƒë·ªÉ gi·∫£ l·∫≠p qu√° tr√¨nh duy chuy·ªÉn c·ªßa xe trong chu·ªói cung ·ª©ng ƒë·ªÉ ·ª©ng t√≠nh ETD v√† ETA.

Trong **R** c√≥ package `simmer` thu·∫ßn v·ªÅ x√¢y d·ª±ng m√¥ h√¨nh *DES*, ƒë√≤i h·ªèi 3 nh√¢n t·ªë l√†: (i) H√†nh vi ho·∫°t ƒë·ªông c·ªßa ƒë·ªëi t∆∞·ª£ng, (ii) H√†m t√≠nh th·ªùi gian cho ho·∫°t ƒë·ªông v√† (iii) M√¥i tr∆∞·ªùng ƒë·ªÉ ch·∫°y m√¥ ph·ªèng. B·∫°n c√≥ th·ªÉ ƒë·ªçc b√†i vi·∫øt n√†y ƒë·ªÉ bi·∫øt th√™m [simmerR](https://www.supplychaindataanalytics.com/simmer-in-r-for-discrete-event-simulation/).

### M√¥ h√¨nh DES:

C√°c object c·∫ßn c√≥ trong m√¥ h√¨nh *DES* l√†:

-   **Entitiy**: l√† ƒë·ªëi t∆∞·ª£ng ch√≠nh c·∫ßn quan s√°t, v√≠ d·ª•: kh√°ch h√†ng. B·∫°n s·ª≠ d·ª•ng h√†m `add_generator()` ƒë·ªÉ th√™m ƒë·ªëi t∆∞·ª£ng v√†o m√¥ h√¨nh.

-   **Attribute**: l√† *property* c·ªßa *entity* (c√≥ th·ªÉ hi·ªÉu l√† ƒë·∫∑c t√≠nh, tr·∫°ng th√°i,...).

-   **Resource**: l√† m·ªôt ngu·ªìn l·ª±c m√† *entity* ƒë∆∞·ª£c quy·ªÅn d√πng, v√≠ d·ª• nh∆∞ nh√¢n vi√™n qu√°n cafe c·∫ßn h·ªó tr·ª£ kh√°ch h√†ng khi c√≥ y√™u c·∫ßu. D√πng h√†m `add_resource()` ƒë·ªÉ th√™m v√† x√°c ƒë·ªãnh s·ªë l∆∞·ª£ng resource b·∫±ng ƒë·ªëi s·ªë: `capacity = n`.

-   **Queue**: l√† m·ªôt chu·ªói ƒë·ªÉ c√°c *entity* tham gia v√†o, v√≠ d·ª• nh∆∞ h√†ng x·∫øp ch·ªù l·∫•y n∆∞·ªõc ·ªü qu√°n cafe.

-   **Event**: c√°c s·ª± ki·ªán thay ƒë·ªïi trong h·ªá th·ªëng.

V√≠ d·ª• nh∆∞ ƒëo·∫°n code d∆∞·ªõi ƒë√¢y:

```{r}
#| warning: false
#| message: false
#| echo: true
library(simmer)
set.seed(1234)
# Define the trajectory for the vehicle's process
vehicle_traj <- trajectory("Vehicle Process") %>%
  # Step 1: Take Order
  timeout(function() rnorm(n=1, mean = 30, sd = 3)) %>% # Time to take an order
  
  # Step 2: Check if goods are available in the warehouse
  seize("warehouse", 1) %>%  
  timeout(function() rexp(1, 0.3)) %>%  # Time to check if goods are available
  release("warehouse", 1) %>%  # Release the warehouse resource after checking
  
  # Step 3: If goods are not available, wait for manufacturing (conditional)
  branch(
    option = function() ifelse(runif(1) < 0.5, 1, 2),  # 50% chance
    continue = c(TRUE, TRUE),
    trajectory() %>% 
      timeout(function() rexp(1, 0.8)),  # Manufacturing time if goods aren't available
    
    trajectory("WaitForStock")  # Second branch if goods are available
  ) %>%
  
  # Step 4: Loading the goods
  seize("truck", 1) %>%  # Seize one truck for loading
  timeout(function() rexp(1, 0.6)) %>%  # Loading time
  release("truck", 1) %>%  # Release truck after loading
  
  # Step 5: Transport to store
  timeout(function() rexp(1, 1)) %>%  # Transport time
  
  # Step 6: Unload the goods at the store
  seize("store", 1) %>%  # Seize one store resource for unloading
  timeout(function() rexp(1, 0.4)) %>%  # Unloading time
  release("store", 1)  # Release store resource

# Create an environment
env <- simmer("Vehicle Simulation") %>%
  add_resource("warehouse", capacity = 1) %>%  
  add_resource("truck", capacity = 1) %>%  
  add_resource("store", capacity = 1) %>%  
  
  # Add generator for vehicles arriving with an exponential inter-arrival time
  add_generator("vehicle", vehicle_traj, function() rexp(1, 0.1))  # Average of 10 vehicles per 100 time units

# Run the simulation for a longer duration
env %>% 
  run(until = 500)

start_time <- as.POSIXct("2024-11-09 08:30:00", 
                         format="%Y-%m-%d %H:%M:%S")

arrivals<-get_mon_arrivals(env, per_resource = T)
arrivals$datetime <- start_time + (arrivals$start_time * 60)  
arrivals$finish_datetime <- start_time + (arrivals$end_time * 60)  
```

Th√¥ng tin t·ª´ **R** ƒë∆∞·ª£c xu·∫•t ra cho th·∫•y th·ªùi gian ch·∫°y l√† 500 v√† c√≥ 45 xe ƒë√£ di chuy·ªÉn v√†o h·ªá th·ªëng. K·∫øt qu·∫£ gi·∫£ l·∫≠p ƒë∆∞·ª£c th·ªÉ hi·ªán nh∆∞ sau: c√°c ƒë·ªëm th·ªÉ hi·ªán th·ªùi ƒëi·ªÉm xe ƒëi v√†o, ch·ªù gi·∫£i quy·∫øt y√™u c·∫ßu v√† ƒëi ra kh·ªèi h√†ng ch·ªù.

![Bi·ªÉu ƒë·ªì 1: Discrete Event Simulation](DES.gif)

V√† ch√∫ng ta s·∫Ω c√≥ final output g·ªìm:

::: tabset
#### Resources:

```{r}
#| warning: false
#| message: false
#| fig-cap: "Bi·ªÉu ƒë·ªì 2: Quy tr√¨nh di chuy·ªÉn gi·∫£ l·∫≠p c·ªßa xe"
#| fig-cap-location: bottom

library(simmer.plot)
resources <- get_mon_resources(env)
plot(resources, 
     metric = "usage",
     c("warehouse", "truck","store"),
     items = "server")
```

#### Simulation:

```{r}
#| warning: false
#| message: false
#| fig-cap: "Bi·ªÉu ƒë·ªì 3: Th·ªùi gian gi·∫£ l·∫≠p c·ªßa xe"
#| fig-cap-location: bottom


library(highcharter)
arrivals |> 
  dplyr::select(c(start_time,
           end_time,
           activity_time)) |> 
  pivot_longer(cols = everything(),
               values_to = "time",
               names_to = "type") |> 
hchart(
  'line', 
  hcaes(y = time,
        group = type)
  ) 
```
:::

### M√¥ h√¨nh ABM:

Kh√°c v·ªõi *DES*, *ABM* quan t√¢m nhi·ªÅu h∆°n ƒë·∫øn c√°c ƒë·∫∑c t√≠nh, th√¥ng tin c·ªßa c√° th·ªÉ trong qu·∫ßn th·ªÉ n√†y. Do ƒë√≥, ch·ªâ v·ªõi l∆∞·ª£ng th√¥ng tin v·ªÅ s·ªë xe, s·ªë nh√† kho, s·ªë c·ª≠a h√†ng v√† quy tr√¨nh ho·∫°t ƒë·ªông l√† ch∆∞a ƒë·ªß ƒë·ªÉ x√¢y d·ª±ng m√¥ h√¨nh *ABM*. C√°c d·ªØ li·ªáu kh·∫£ thi c√≥ th·ªÉ bao g·ªìm: th√¥ng tin c·ªßa ƒë·ªôi xe: g·ªìm bao nhi√™u ng∆∞·ªùi ho·∫∑c g·ªìm nh·ªØng ai; d·ªØ li·ªáu qu√° kh·ª© v·ªÅ KPI, h·ªçc v·∫•n,...; th√¥ng tin v·ªÅ th·ªùi gian ho·∫°t ƒë·ªông c·ªßa c√°c c·ª≠a h√†ng; v·ªã tr√≠ v√† th√¥ng tin v·ªÅ ƒë∆∞·ªùng x√° c√≥ c·∫•m t·∫£i kh√¥ng;... *ABM* th∆∞·ªùng ƒë∆∞·ª£c ·ª©ng d·ª•ng v√†o vi·ªác x√°c ƒë·ªãnh c√°c *risks - r·ªßi ro* trong qu·∫£n l√≠ chu·ªói cung ·ª©ng

Trong R c√≥ th∆∞ vi·ªán `NetLogoR` h·ªó tr·ª£ ch√∫ng ta t·ªët v·ªÅ m·∫£ng m√¥ h√¨nh *ABM*. V·ªÅ n·ªÅn t·∫£ng, *ABM* c·∫ßn c√°c y·∫øu t·ªë c∆° b·∫£n sau:

-   *Agents*: l√† c√° th·ªÉ ho·∫°t ƒë·ªông trong m√¥i tr∆∞·ªùng gi·∫£ l·∫≠p, c√≥ th·ªÉ l√† con ng∆∞·ªùi, xe c·ªô, ...

-   *World*: M√¥i tr∆∞·ªùng m√† c√°c *agent* "s·ªëng" b√™n trong.

-   *Set of rules*: Nh·ªØng lu·∫≠t l·ªá m√† t·∫•t c·∫£ *agent* "s·ªëng "trong *world* ph·∫£i tu√¢n theo.

-   *Loop*: L√† s·ª± l·∫∑p ƒëi l·∫∑p l·∫°i c·ªßa c√°c ho·∫°t ƒë·ªông, s·ª± t∆∞∆°ng t√°c. Trong l·∫≠p tr√¨nh th√¨ n√≥ gi·ªëng nh∆∞ v√≤ng l·∫∑p *for if* quen thu·ªôc c√≤n trong ƒë·ªùi th·ª±c nh∆∞ cu·ªôc s·ªëng h·∫±ng ng√†y c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c l·∫∑p ƒëi l·∫∑p l·∫°i v√≠ d·ª•: s√°ng th√¨ ƒëi h·ªçc, t·ªëi th√¨ ƒëi ng·ªß v√† c√≥ th·ªÉ c√≥ c√°c ƒë·ªôt bi·∫øn nh∆∞: s√°ng nay ƒë∆∞·ª£c ngh·ªâ h·ªçc, t·ªëi th·ª© 7 th√¨ th·ª©c c·∫£ ƒë√™m (ƒê√¢y l·∫°i l√† ho·∫°t ƒë·ªông quen thu·ªôc c·ªßa t√¥i!!!).

Nh∆∞ v·∫≠y, b·∫°n c√≥ th·ªÉ h√¨nh dung m∆° h·ªì v·ªÅ qu·∫ßn th·ªÉ gi·∫£ l·∫≠p bao g·ªìm: c√°c chi·∫øc xe, c√°c *nodes* trong *supply chain* nh∆∞: nh√† kho, c·ª≠a h√†ng,...

![Bi·ªÉu ƒë·ªì 4: Simple of Agent Based Modeling](trajectory-animation.gif)

Nh∆∞ tr√™n ƒë√¢y l√† v√≠ d·ª• v·ªÅ c√°ch *simulation* cho 1 ƒë·ªëi t∆∞·ª£ng di chuy·ªÉn trong m·∫∑t ph·∫≥ng 10x10. ƒê·ªëi t∆∞·ª£ng s·∫Ω di chuy·ªÉn m·ªói l·∫ßn 1 √¥ v·ªõi 4 h∆∞·ªõng di chuy·ªÉn: "up","down","left","right" v√† ƒë∆∞·ª£c ch·ªçn h∆∞·ªõng random. K·∫øt qu·∫£ sau 50 b∆∞·ªõc th√¨ ƒë·ªëi t∆∞·ª£ng ƒë√£ di chuy·ªÉn ƒë·∫øn ƒëi·ªÉm *dropoff*.

D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• ph·ª©c t·∫°p h∆°n v·ªÅ gi·∫£ l·∫≠p th·ªùi gian di chuy·ªÉn d·ª± ki·∫øn c·ªßa xe v·ªõi c√°c ƒë·∫∑c ƒëi·ªÉm sau:

-   **Nh·∫≠n th√¥ng tin xe**: th·ªùi gian s·∫Ω random t·ª´ 8h30 ƒë·∫øn 9h.

-   **G·ªçi xe**: Vi·ªác n√†y s·∫Ω ho√†n th√†nh trong 15 ph√∫t.

-   **Xe di chuy·ªÉn ƒë·∫øn ƒëi·ªÉm pickup**: T√≠nh th·ªùi gian di chuy·ªÉn b·∫±ng `transportation time = distance/average speed` c·ªông v·ªõi th·ªùi gian `loading time = 30'`.

-   *Xe di chuy·ªÉn ƒë·∫øn ƒëi·ªÉm dropoff*: T√≠nh th·ªùi gian di chuy·ªÉn b·∫±ng `transportation time = distance/average speed` c·ªông v·ªõi th·ªùi gian `unloading time = 40'`.

K·∫øt qu·∫£ gi·∫£ l·∫≠p cho 5 xe nh∆∞ sau:

```{r}
#| warning: false
#| message: false
library(NetLogoR)
library(lubridate)
library(tidyverse)

# Define new time parameters for the extended simulation
n_vehicles <- 5              # Number of vehicles
grid_size <- 20              # Size of the grid
speed_limit <- 2             # Speed limit (cells per tick)
time_step <- 1               # Simulation time step (1 second per tick)
order_creation_time <- c(hm("8:30"), hm("9:00"))   # Time when orders are released (8:30 AM)
n_customer <- 5

n_ticks <- 48  # Increase simulation time

# Initialize the world, orders, and vehicle positions
world <- createWorld(minPxcor = -grid_size, 
                     maxPxcor = grid_size, 
                     minPycor = -grid_size, 
                     maxPycor = grid_size)

random_coords <- randomXYcor(world, n = n_vehicles)

# Define orders and vehicles
orders <- data.frame(
  order_id = 1:n_customer,
  pickup_x = sample(1:grid_size, n_customer, replace = TRUE),
  pickup_y = sample(1:grid_size, n_customer, replace = TRUE),
  dropoff_x = sample(1:grid_size, n_customer, replace = TRUE),
  dropoff_y = sample(1:grid_size, n_customer, replace = TRUE),
  order_time = as.POSIXct("08:30:00", format = "%H:%M:%S") + runif(n_customer, 0, 1800)
)

# Initialize vehicles' position and speed
vehicles_df <- data.frame(
  vehicle_id = 1:n_vehicles,
  xcor = random_coords[, 1],
  ycor = random_coords[, 2],
  speed = rep(1.5, n_vehicles)
)

# Initialize tracking variables
vehicle_order <- rep(NA, n_vehicles)
order_status <- rep(NA, n_customer)
vehicle_state <- rep("waiting", n_vehicles)  # New: track state of each vehicle
ETA <- rep(NA, n_vehicles)  # Initialize ETA for each vehicle
ETD <- rep(NA, n_vehicles)  # Initialize ETD for each vehicle
completed_time <- rep(NA, n_vehicles)  # Initialize completed time for each vehicle

# Function to simulate vehicle movement (with speed and direction)
move_vehicle <- function(vehicle, destination) {
  angle_to_dest <- atan2(destination[2] - vehicle$ycor, destination[1] - vehicle$xcor)
  distance_to_dest <- sqrt((vehicle$xcor - destination[1])^2 + (vehicle$ycor - destination[2])^2)
  
  # Move the vehicle
  distance_to_move <- min(distance_to_dest, vehicle$speed)
  vehicle$xcor <- vehicle$xcor + distance_to_move * cos(angle_to_dest)
  vehicle$ycor <- vehicle$ycor + distance_to_move * sin(angle_to_dest)
  
  return(vehicle)
}

# Function to calculate the distance between two points
calculate_distance <- function(x1, y1, x2, y2) {
  return(sqrt((x1 - x2)^2 + (y1 - y2)^2))
}

# Function to check if a vehicle is at a location (pickup/dropoff)
at_location <- function(vehicle, location) {
  return(abs(vehicle$xcor - location[1]) < 0.5 && abs(vehicle$ycor - location[2]) < 0.5)
}

simulation_start_time <- as.POSIXct("08:00:00", format = "%H:%M:%S")

# Initialize an empty data frame to store the results
final_results <- data.frame()

# Simulation loop with updated conditions
for (tick in 1:n_ticks) {
  current_time <- simulation_start_time + seconds(tick) * 3600 / 2
  
  # Process each vehicle
  for (i in 1:n_vehicles) {
    if (is.na(vehicle_order[i])) {  
      # Assign a vehicle to an order if it's free and an order is available
      for (j in 1:nrow(orders)) {
        if (is.na(order_status[j]) && current_time >= orders$order_time[j]) {
          order_status[j] <- "in_progress"  # Change order status to in_progress
          vehicle_order[i] <- j
          vehicle_state[i] <- "received"  # Vehicle starts receiving the order
          
          # Calculate ETA (time to reach pickup location)
          distance_to_pickup <- calculate_distance(vehicles_df$xcor[i], vehicles_df$ycor[i], 
                                                   orders$pickup_x[j], orders$pickup_y[j])
          transportation_time <- distance_to_pickup / vehicles_df$speed[i]  # Time to pickup location in hours
          ETA[i] <- orders$order_time[j] + seconds(transportation_time) * 3600  # ETA in POSIXct object
          
          break
        }
      }
    }
    
    # Get current order info for the assigned order
    assigned_order <- vehicle_order[i]
    
    if (!is.na(assigned_order)) {
      pickup_loc <- c(orders$pickup_x[assigned_order], orders$pickup_y[assigned_order])
      dropoff_loc <- c(orders$dropoff_x[assigned_order], orders$dropoff_y[assigned_order])
      
      # Handle movement to pickup location
      if (vehicle_state[i] == "received") {
        if (!at_location(vehicles_df[i, ], pickup_loc)) {
          vehicles_df[i, ] <- move_vehicle(vehicles_df[i, ], pickup_loc)
        } else {
          vehicle_state[i] <- "loading"  # Transition to loading state
        }
      }
      
      # Handle loading phase (vehicle at pickup location)
      if (vehicle_state[i] == "loading") {
        if (at_location(vehicles_df[i, ], pickup_loc)) {
          vehicle_state[i] <- "enroute"  # Transition to enroute state
          
          # Calculate the transportation time to dropoff location
          distance_to_dropoff <- calculate_distance(vehicles_df$xcor[i], vehicles_df$ycor[i], 
                                                   dropoff_loc[1], dropoff_loc[2])
          transportation_time <- distance_to_dropoff / vehicles_df$speed[i]
          ETD[i] <- ETA[i] + seconds(transportation_time*3600 + 30*60)   # Add transportation time to dropoff location
        }
      }
      
      # Handle enroute phase (vehicle moving to dropoff location)
      if (vehicle_state[i] == "enroute") {
        if (!at_location(vehicles_df[i, ], dropoff_loc)) {
          vehicles_df[i, ] <- move_vehicle(vehicles_df[i, ], dropoff_loc)
        } else {
          vehicle_state[i] <- "completed"  # Transition to completed state
          
          # Set completed time (ETD + unloading time 40 minutes)
          completed_time[i] <- ETD[i] + seconds(40*60)  # Unloading time 40 minutes
        }
      }
      
      # Handle unloading phase (vehicle at dropoff location)
      if (vehicle_state[i] == "completed") {
        order_status[assigned_order] <- "completed"
      }
    }
  }
  
  # Store the current simulation results with time info
  tick_result <- data.frame(
    time = current_time,
    vehicle_id = 1:n_vehicles,
    xcor = vehicles_df$xcor,
    ycor = vehicles_df$ycor,
    speed = vehicles_df$speed,
    order_status = order_status,
    vehicle_order = vehicle_order,
    vehicle_state = vehicle_state,  # Track vehicle state
    ETA = ETA,  # Estimated Time of Arrival
    ETD = ETD,  # Estimated Time of Departure
    completed_time = completed_time  # Completed Time
  ) 
  
  # Append the current results to the final_results data frame
  final_results <- bind_rows(final_results, tick_result)
}

final_results <- final_results|> 
  filter(!is.na(order_status)) |> 
    mutate(ETA = as.POSIXct(ETA, origin = "1970-01-01", tz = "UTC"),
           ETD = as.POSIXct(ETD, origin = "1970-01-01", tz = "UTC"),
           completed_time = as.POSIXct(completed_time, origin = "1970-01-01", tz = "UTC"))

final<-final_results[!duplicated(final_results[, setdiff(names(final_results), "time")]), ]
```

![Bi·ªÉu ƒë·ªì 5: Agent Based Modeling](ABM.gif)

K·∫øt qu·∫£ cho th·∫•y **xe 1** v√† **xe 2** c√≥ kh·∫£ nƒÉng tr·ªÖ chuy·∫øn n√™n c·∫ßn l∆∞u √Ω v√† h·ªó tr·ª£ t√†i x·∫ø ƒë·ªÉ ƒë·∫£m b·∫£o xe ƒë·∫øn ƒë√∫ng gi·ªù h√†nh ch√≠nh. Nh∆∞ v·∫≠y ch√∫ng ta ƒë√£ k·∫øt th√∫c b√†i h·ªçc ·ªü ƒë√¢y.

## K·∫øt lu·∫≠n:

N·∫øu b·∫°n c√≥ c√¢u h·ªèi hay th·∫Øc m·∫Øc n√†o, ƒë·ª´ng ng·∫ßn ng·∫°i li√™n h·ªá v·ªõi m√¨nh qua Gmail. B√™n c·∫°nh ƒë√≥, n·∫øu b·∫°n mu·ªën xem l·∫°i c√°c b√†i vi·∫øt tr∆∞·ªõc ƒë√¢y c·ªßa m√¨nh, h√£y nh·∫•n v√†o hai n√∫t d∆∞·ªõi ƒë√¢y ƒë·ªÉ truy c·∫≠p trang **Rpubs** ho·∫∑c m√£ ngu·ªìn tr√™n **Github**. R·∫•t vui ƒë∆∞·ª£c ƒë·ªìng h√†nh c√πng b·∫°n, h·∫πn g·∫∑p l·∫°i! üòÑüòÑüòÑ

```{=html}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Me</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-icons@v6.0.0/svgs/rstudio.svg">
    <style>
        body { font-family: Arial, sans-serif; background-color: $secondary-color; }
        .container { max-width: 400px; margin: auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); }
        label { display: block; margin: 10px 0 5px; }
        input[type="email"] { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 4px; }
        .github-button, .rpubs-button { margin-top: 20px; text-align: center; }
        .github-button button, .rpubs-button button { background-color: #333; color: white; border: none; padding: 10px; cursor: pointer; border-radius: 4px; width: 100%; }
        .github-button button:hover, .rpubs-button button:hover { background-color: #555; }
        .rpubs-button button { background-color: #75AADB; }
        .rpubs-button button:hover { background-color: #5A9BC2; }
        .rpubs-icon { margin-right: 5px; width: 20px; vertical-align: middle; filter: brightness(0) invert(1); }
        .error-message { color: red; font-size: 0.9em; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Contact Me</h2>
        <form id="emailForm">
            <label for="email">Your Email:</label>
            <input type="email" id="email" name="email" required aria-label="Email Address">
            <div class="error-message" id="error-message" style="display: none;">Please enter a valid email address.</div>
            <button type="submit">Send Email</button>
        </form>
        <div class="github-button">
            <button>
                <a href="https://github.com/Loccx78vn/Simulation_in_R" target="_blank" style="color: white; text-decoration: none;">
                    <i class="fab fa-github"></i> View Code on GitHub
                </a>
            </button>
        </div>
        <div class="rpubs-button">
            <button>
                <a href="https://rpubs.com/loccx" target="_blank" style="color: white; text-decoration: none;">
                    <img src="https://cdn.jsdelivr.net/npm/simple-icons@v6.0.0/icons/rstudio.svg" alt="RStudio icon" class="rpubs-icon"> Visit my RPubs
                </a>
            </button>
        </div>
    </div>

    <script>
        document.getElementById('emailForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission
            const emailInput = document.getElementById('email');
            const email = emailInput.value;
            const errorMessage = document.getElementById('error-message');

            // Simple email validation regex
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (emailPattern.test(email)) {
                errorMessage.style.display = 'none'; // Hide error message
                const yourEmail = 'loccaoxuan103@gmail.com'; // Your email
                const gmailLink = `https://mail.google.com/mail/?view=cm&fs=1&to=${yourEmail}&su=Help%20Request%20from%20${encodeURIComponent(email)}`;
                window.open(gmailLink, '_blank'); // Open in new tab
            } else {
                errorMessage.style.display = 'block'; // Show error message
            }
        });
    </script>
</body>
</html>
```
